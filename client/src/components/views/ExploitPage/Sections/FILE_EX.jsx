import React, { useState } from "react";
import { Button, message, Divider, List, Typography } from "antd";
import Axios from "axios";

function getExtensionOfFilename(filename) {
  var _fileLen = filename.length;

  /**
   * lastIndexOf('.')
   * 뒤에서부터 '.'의 위치를 찾기위한 함수
   * 검색 문자의 위치를 반환한다.
   * 파일 이름에 '.'이 포함되는 경우가 있기 때문에 lastIndexOf() 사용
   */
  var _lastDot = filename.lastIndexOf(".");

  // 확장자 명만 추출한 후 소문자로 변경
  var _fileExt = filename.substring(_lastDot, _fileLen).toLowerCase();

  return _fileExt;
}

function FILE_EX() {
  const [Files, setFiles] = useState([]);
  const [CrackResult, setCrackResult] = useState([]);

  const loadFile = () => {
    Axios.post("http://AttackServerAddress/api/attacks/loadFile").then(
      (response) => {
        if (response.data.success) {
          setFiles(response.data.files);
          message.success("complete!");
        } else {
          message.error("Fail to attack");
        }
      }
    );
  };

  const crackZip = (filename) => {
    const variable = {
      fileName: filename,
    };

    Axios.post("http://AttackServerAddress/api/attacks/crackZip", variable).then(
      (response) => {
        if (response.data.success) {
          setCrackResult(response.data.results);
          message.success("complete!");
        } else {
          message.error("Fail to attack");
        }
      }
    );
  };

  return (
    <div>
      <Divider orientation="left">Download Folder</Divider>
      <List
        bordered
        dataSource={Files}
        renderItem={(item) => (
          <List.Item>
            <Typography.Text mark>[/download]</Typography.Text>{" "}
            {getExtensionOfFilename(item) == ".zip" ? (
              <a onClick={() => crackZip(item)}>{item}</a>
            ) : (
              item
            )}
          </List.Item>
        )}
      />
      {CrackResult ? <h3>{CrackResult}</h3> : ""}
      <Button onClick={loadFile}>Load File</Button>
    </div>
  );
}

export default FILE_EX;
