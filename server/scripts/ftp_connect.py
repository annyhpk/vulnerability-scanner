#!/usr/bin/env python3
#-*- coding:utf-8 -*-

import ftplib
import sys
import time

HOST = sys.argv[1]
USER = sys.argv[2]
PASSWORD = sys.argv[3]
COMMAND = sys.argv[4]

CMDs = COMMAND.split(' ')

ftp = ftplib.FTP(HOST)
print(ftp.getwelcome())
ftp.login(user=USER, passwd=PASSWORD)

try:
    if len(CMDs) < 2:
        result = ftp.sendcmd(COMMAND)
        time.sleep(10)
        print(result)

        lists = []
        ftp.dir(lists.append)

        for line in lists:
            print(line)

    elif CMDs[0] == "get":
        target = CMDs[1]
        copy = "/root/Server/scripts/download/" + CMDs[1]

        with open(copy, "wb") as f:
            ftp.cwd("/Server/scripts/upload")
            res = ftp.retrbinary("RETR " + target, f.write(copy.encode("utf-8")))
            time.sleep(5)
            print(res)

    elif CMDs[0] == "put":
        target = "/root/Server/scripts/download/" + CMDs[1]
        copy = "/root/Server/scripts/upload/" + CMDs[1]

        res = ftp.storbinary("STOR " + copy, open(target, "rb"))
        time.sleep(10)
        print(res)

except ftplib.error_perm as e:
    pass


ftp.quit()